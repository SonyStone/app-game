import{o as F,m as L}from"./vendor.110b933d.js";import{I as a,P as c,C as x,J as X,K as E,U as q}from"./pixi.4c9cfd7e.js";import{u as R}from"./index.3962126e.js";import{a as P,e as g,f as d,d as m,m as w,p as $,b as k,t as M}from"./tap.4df8a27d.js";function G(e,t){return P(t)?g(e,t,1):g(e,1)}function W(){return new a().lineStyle(2,1644825,1).beginFill(12529712).drawRect(-20,-15,40,30).endFill().moveTo(-20,15).lineTo(20,.5).lineTo(20,-.5).lineTo(-20,-15)}function I(){return new a().beginFill(12529712).lineStyle(2,1644825,1).drawRect(0,-10/2,30,10).closePath().drawCircle(0,0,10).closePath().endFill()}class l{static fromAngle(t){return{x:Math.cos(t),y:Math.sin(t)}}static angleTo(t,i){return Math.atan2(t.y-i.y,t.x-i.x)}static clone(t={x:0,y:0}){return{x:t.x,y:t.y}}static magnitude(t){return Math.sqrt(t.x*t.x+t.y*t.y)}static sum(t,i){return typeof i=="number"?{x:t.x+i,y:t.y+i}:{x:t.x+i.x,y:t.y+i.y}}static sub(t,i){return typeof i=="number"?new this(t.x-i,t.y-i):new this(t.x-i.x,t.y-i.y)}static mult(t,i){return typeof i=="number"?new this(t.x*i,t.y*i):new this(t.x*i.x,t.y*i.y)}static div(t,i){return typeof i=="number"?{x:t.x/i,y:t.y/i}:{x:t.x/i.x,y:t.y/i.y}}static set(t){const i={x:0,y:0};return typeof t=="number"?(i.x=t,i.y=t):(i.x=t.x,i.y=t.y),i}static invert(t){return{x:-t.x,y:-t.y}}static magnitudeSquared(t){return t.x*t.x+t.y*t.y}static rotate(t,i){const s=Math.cos(i),r=Math.sin(i);return{x:t.x*s-t.y*r,y:t.x*r+t.y*s}}static isLessOrEqual(t,i){return t.x<=i.x&&t.y<=i.y}static isGreaterOrEqual(t,i){return t.x>=i.x&&t.y>=i.y}static isLess(t,i){return t.x<i.x&&t.y<i.y}static isGreater(t,i){return t.x>i.x&&t.y>i.y}static getScalar(t){return t.x>t.y?t.x:t.y}static smaller(t,i){return{x:t.x<i.x?t.x:i.x,y:t.y<i.y?t.y:i.y}}static larger(t,i){return{x:t.x>i.x?t.x:i.x,y:t.y>i.y?t.y:i.y}}static small(t){return t.x>t.y?{x:t.x,y:t.x}:{x:t.y,y:t.y}}static large(t){return t.x<t.y?{x:t.x,y:t.x}:{x:t.y,y:t.y}}constructor(t,i){this.x=t||0,this.y=i||0}set(t){return this.x=t.x,this.y=t.y,this}zero(){return this.x=0,this.y=0,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}getX(){return this.x}getY(){return this.y}clone(){return new l(this.x,this.y)}copy(t){return this.set(t)}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}magSq(){return this.x*this.x+this.y*this.y}add(t){return typeof t=="number"?(this.x+=t,this.y+=t):(this.x+=t.x,this.y+=t.y),this}sub(t){return typeof t=="number"?(this.x-=t,this.y-=t):(this.x-=t.x,this.y-=t.y),this}subX(t){return this.x-=t,this}subY(t){return this.y-=t,this}mult(t){return typeof t=="number"?(this.x*=t,this.y*=t):(this.x*=t.x,this.y*=t.y),this}div(t){return typeof t=="number"?(this.x/=t,this.y/=t):(this.x/=t.x,this.y/=t.y),this}dist(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}dot(t){return this.x*t.x+this.y*t.y}normalize(){return this.div(this.mag())}limit(t){return this.magSq()>t*t&&this.normalize().mult(t),this}setMag(t){return this.normalize().mult(t)}heading(){return Math.atan2(this.y,this.x)}rotate(t){const i=Math.cos(t),s=Math.sin(t);return new l(this.x*i-this.y*s,this.x*s+this.y*i)}lerp(t,i){return i>1&&(i=1),i<0&&(i=0),this.mult(i).add(t.clone().mult(1-i))}invert(){return this.x*=-1,this.y*=-1,this}positioning(t){return this.invert().rotate(t.rotation).mult(t.zoom).add(t.focus)}getScalar(){return this.x>this.y?this.x:this.y}toArray(){return[this.x,this.y]}toString(){return"x:"+this.x.toFixed(2)+", y:"+this.y.toFixed(2)+`
`}}class n{constructor(t,i){this.x=t||0,this.y=i||0}static fromAngle(t){return new n(Math.cos(t),Math.sin(t))}static angleTo(t,i){return Math.atan2(t.y-i.y,t.x-i.x)}static clone(t){return new n(t.x,t.y)}static magnitude(t){return Math.sqrt(t.getX()*t.getX()+t.getY()*t.getY())}static magnitudeSquared(t){return t.getX()*t.getX()+t.getY()*t.getY()}static rotate(t,i){return new n(t.getX()*Math.cos(i)-t.getY()*Math.sin(i),t.getX()*Math.sin(i)+t.getY()*Math.cos(i))}static rotateAbout(t,i,s){const r=Math.cos(i),o=Math.sin(i),h=s.x+((t.x-s.x)*r-(t.y-s.y)*o),u=s.y+((t.x-s.x)*o+(t.y-s.y)*r);return new n(h,u)}static isLessOrEqual(t,i){return t.getX()<=i.getX()&&t.getY()<=i.getY()}static isGreaterOrEqual(t,i){return t.getX()>=i.getX()&&t.getY()>=i.getY()}static isLess(t,i){return t.getX()<i.getX()&&t.getY()<i.getY()}static isGreater(t,i){return t.getX()>i.getX()&&t.getY()>i.getY()}getX(){return this.x}getY(){return this.y}set(t,i){return typeof t=="object"?(this.x=t.x,this.y=t.y):typeof t=="number"&&typeof i=="number"&&(this.x=t,this.y=i),this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZero(){return this.x=0,this.y=0,this}copy(){return new n(this.x,this.y)}mag(){return Math.sqrt(this.x*this.x+this.y*this.y)}magSq(){return this.x*this.x+this.y*this.y}add(t){return new n(this.x+t.x,this.y+t.y)}sub(t){return new n(this.x-t.x,this.y-t.y)}mult(t){return new n(this.x*t,this.y*t)}div(t){return new n(this.x/t,this.y/t)}dist(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}dot(t){return this.x*t.x+this.y*t.y}normalize(){return this.div(this.mag())}limit(t){return this.magSq()>t*t&&this.normalize().mult(t),this}setMag(t){return this.normalize().mult(t)}heading(){return Math.atan2(this.y,this.x)}rotate(t){return new n(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t))}lerp(t,i){return i>1&&(i=1),i<0&&(i=0),this.mult(i).add(t.copy().mult(1-i))}invert(){const t=this.x*-1,i=this.y*-1;return new n(t,i)}positioning(t){return this.invert().rotate(t.rotation).mult(t.zoom).add(t.focus)}toArray(){return[this.x,this.y]}toString(){return"x:"+this.x.toFixed(2)+", y:"+this.y.toFixed(2)+" "}}class D{constructor(t,i,s){this.position=t||new n,this.zoom=i||1,this.rotation=s||0,this.focus=new n}targeting(t){return l.mult(t,this.zoom).rotate(this.rotation).add(this.position)}manipulation(t,i){(t.NumpadAdd.pressed||i.WheelUp.pressed)&&(this.zoom*=1.1),(t.NumpadSub.pressed||i.WheelDown.pressed)&&(this.zoom/=1.1),t.e.pressed&&(this.rotation-=.1),t.q.pressed&&(this.rotation+=.1)}focusing(t,i){i===void 0&&(i=new n),this.focus.set(t.width/2,t.height/2),this.position=this.position.set(i.positioning(this))}draw(t){t.translate(this.position.x,this.position.y),t.scale(this.zoom,this.zoom),t.rotate(this.rotation)}translate(t){t.scale=new c(this.zoom,this.zoom),t.position=new c(this.position.x,this.position.y),t.rotation=this.rotation}toString(){return`camera 
position: ${this.position}
zoom: ${this.zoom}
rotation: ${this.rotation}
`}}class U{constructor(t,i){return this.ctx=new a,this.ctx.beginFill(7833209),this.ctx.drawEllipse(0,0,640,640),this.ctx.x=t,this.ctx.y=i,this.ctx.endFill(),this}}class N extends x{constructor(t){super();return this.length=length||1,this.thickness=t||.1,this.addChild(this.setLocator()),this}setLocator(){const t=new a;return t.lineStyle(.1,16711680,1).moveTo(this.x,this.y).lineTo(1,this.y).lineStyle(.1,255,1).moveTo(this.x,this.y).lineTo(this.x,1),t}}class O extends x{constructor(){super();this.color=12529712,this.direction=new n,this.speed=5,this.positionRotation=0,this.target=new n,this.targetRotation=0,this.body=this.getBody(),this.gun=this.getGun(),this.boundingBox=new a,this.interactive=!0,this.pull=new n;const t=new N().setTransform(0,0,10,10);this.addChild(this.body),this.addChild(this.gun),this.addChild(this.boundingBox),this.gun.addChild(t)}player(t,i,s){this.targetRotation=n.angleTo(this.target.set(i),s.targeting(this.position))-s.rotation;let r=0;(t.up.pressed||t.w.pressed)&&(this.direction=this.direction.add(n.fromAngle(-Math.PI/2-s.rotation)),r=this.speed),(t.down.pressed||t.s.pressed)&&(this.direction=this.direction.add(n.fromAngle(Math.PI/2-s.rotation)),r=this.speed),(t.left.pressed||t.a.pressed)&&(this.direction=this.direction.add(n.fromAngle(Math.PI-s.rotation)),r=this.speed),(t.right.pressed||t.d.pressed)&&(this.direction=this.direction.add(n.fromAngle(0-s.rotation)),r=this.speed),this.direction=this.direction.normalize(),this.pull=this.pull.add(this.direction.mult(r))}update(){this.positionRotation=n.angleTo(this.pull,this.position),this.position.x=this.pull.x-Math.cos(this.positionRotation)*18,this.position.y=this.pull.y-Math.sin(this.positionRotation)*18,this.body.rotation=this.positionRotation,this.gun.rotation=this.targetRotation,this.updateBoundingBox(this.boundingBox)}toString(){return`position: ${this.position.x.toFixed(2)}, ${this.position.y.toFixed(2)}
pull: ${this.pull.toString()}
direction: ${this.direction.toString()}
targetRotation: ${this.targetRotation.toFixed(2)}
positionRotation: ${this.positionRotation.toFixed(2)}
rotation: ${this.rotation.toFixed(2)}
`}getBody(){return new a().lineStyle(2,1644825,1).beginFill(12529712).drawRect(-20,-15,40,30).endFill().moveTo(-20,15).lineTo(20,.5).lineTo(20,-.5).lineTo(-20,-15)}getGun(){return new a().beginFill(12529712).lineStyle(2,1644825,1).drawRect(0,-10/2,30,10).closePath().drawCircle(0,0,10).closePath().endFill()}updateBoundingBox(t){t.clear();const i=this.getLocalBounds();t.lineStyle(.5,16711680,1).moveTo(i.left,i.bottom).lineTo(i.left,i.top).lineTo(i.right,i.top).lineTo(i.right,i.bottom).closePath()}}function H(e){const t={left:{code:37,pressed:!1},right:{code:39,pressed:!1},up:{code:38,pressed:!1},down:{code:40,pressed:!1},w:{code:87,pressed:!1},a:{code:65,pressed:!1},s:{code:83,pressed:!1},d:{code:68,pressed:!1},e:{code:69,pressed:!1},q:{code:81,pressed:!1},x:{code:88,pressed:!1},z:{code:90,pressed:!1},NumpadAdd:{code:107,pressed:!1},NumpadSub:{code:109,pressed:!1}};return e.addEventListener("keydown",function(i){let s;for(s in t)t.hasOwnProperty(s)&&t[s].code===i.keyCode&&(t[s].pressed=!0)},!1),e.addEventListener("keyup",function(i){let s;for(s in t)t.hasOwnProperty(s)&&t[s].code===i.keyCode&&(t[s].pressed=!1)},!1),t}function K(e){const t={x:0,y:0,LButton:{code:0,pressed:!1},RButton:{code:2,pressed:!1},MButton:{code:1,pressed:!1},WheelUp:{click:!1,get pressed(){return this.click?(this.click=!1,!0):!1}},WheelDown:{click:!1,get pressed(){return this.click?(this.click=!1,!0):!1}}};return e.oncontextmenu=function(i){i.preventDefault()},e.addEventListener("mousemove",function(i){let s,r;const o=Z(s,r,i,e);t.x=o.x,t.y=o.y},!1),e.addEventListener("mousedown",function(i){let s;for(s in t)t.hasOwnProperty(s)&&t[s].code===i.button&&(t[s].pressed=!0)},!1),e.addEventListener("mouseup",function(i){for(const s in t)t.hasOwnProperty(s)&&t[s].code===i.button&&(t[s].pressed=!1)},!1),e.addEventListener("wheel",function(i){i.deltaY<0?t.WheelUp.click=!0:t.WheelDown.click=!0},!1),t}function Z(e,t,i,s){return i.pageX||i.pageY?(e=i.pageX,t=i.pageY):(e=i.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t=i.clientY+document.body.scrollTop+document.documentElement.scrollTop),e-=s.offsetLeft,t-=s.offsetTop,{x:e,y:t}}function J(e){e.interactive=!0,e.buttonMode=!0;const t=d(e,"pointerdown").pipe(m(()=>e.alpha=.5)),i=d(e,"pointermove").pipe(w(o=>(e.data=o.data,e.data.getLocalPosition(e.parent))),$(),w(([o,h])=>({x:o.x-h.x,y:o.y-h.y}))),s=k(d(e,"pointerupoutside"),d(e,"pointerup"),d(document,"mouseup")).pipe(m(()=>e.alpha=1)),r=d(e,"removed");t.pipe(M(r),G(()=>i.pipe(M(s)))).subscribe(o=>{e.x-=o.x,e.y-=o.y})}const Q=.08;function V(){const e=new X({antialias:!0,backgroundColor:1087931});function t(){e.renderer.resize(window.document.body.clientWidth,window.document.body.clientHeight)}window.addEventListener("resize",t),F(()=>{e.stop(),e.destroy(),E(),window.removeEventListener("resize",t)}),t();const i=H(window),s=K(e.renderer.view),r=new D;let o=new n(e.renderer.width/2,e.renderer.height/2);const h=new x,u=[new O],T=e.stage,z=e.ticker;T.addChild(h);const S=new U(0,0).ctx;q.BATCHABLE_SIZE=1;const C=new a().beginFill(12529712).lineStyle(2,1644825,1).arc(0,0,30,0,Math.PI/2,!1).bezierCurveTo(-30,30,-40,0,-40,-80).lineTo(30,-80).closePath().endFill();r.focusing(e.renderer,o),r.translate(h),h.addChild(C);const p=W();p.addChild(I()),h.addChild(p),J(S),u.forEach(y=>{h.addChild(y)});const f=R();return z.add(()=>{f.begin(),u[0].player(i,s,r),r.manipulation(i,s);const y=l.sub(u[0].position,o).mult(Q);o=o.add(y),r.focusing(e.renderer,o),r.translate(h);for(const Y of u)Y.update();e.renderer.render(h),f.end()}),L(()=>e.view)}export{V as default};
