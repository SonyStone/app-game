var H=Object.defineProperty;var W=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var j=(t,e,n)=>e in t?H(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,M=(t,e)=>{for(var n in e||(e={}))V.call(e,n)&&j(t,n,e[n]);if(W)for(var n of W(e))z.call(e,n)&&j(t,n,e[n]);return t};import{o as X,t as P}from"./vendor.110b933d.js";import{u as Y}from"./index.3962126e.js";let s,U=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});U.decode();let v=null;function C(){return(v===null||v.buffer!==s.memory.buffer)&&(v=new Uint8Array(s.memory.buffer)),v}function m(t,e){return U.decode(C().subarray(t,t+e))}const _=new Array(32).fill(void 0);_.push(void 0,null,!0,!1);let y=_.length;function D(t){y===_.length&&_.push(_.length+1);const e=y;return y=_[e],_[e]=t,e}function O(t){return _[t]}function Z(t){t<36||(_[t]=y,y=t)}function J(t){const e=O(t);return Z(t),e}let L=0,k=new TextEncoder("utf-8");const K=typeof k.encodeInto=="function"?function(t,e){return k.encodeInto(t,e)}:function(t,e){const n=k.encode(t);return e.set(n),{read:t.length,written:n.length}};function Q(t,e,n){if(n===void 0){const l=k.encode(t),u=e(l.length);return C().subarray(u,u+l.length).set(l),L=l.length,u}let i=t.length,o=e(i);const r=C();let a=0;for(;a<i;a++){const l=t.charCodeAt(a);if(l>127)break;r[o+a]=l}if(a!==i){a!==0&&(t=t.slice(a)),o=n(o,i,i=a+t.length*3);const l=C().subarray(o+a,o+i);a+=K(t,l).written}return L=a,o}let A=null;function x(){return(A===null||A.buffer!==s.memory.buffer)&&(A=new Int32Array(s.memory.buffer)),A}function ee(t){return()=>{throw new Error(`${t} is not defined`)}}const te=Object.freeze({Dead:0,"0":"Dead",Alive:1,"1":"Alive"});class R{static __wrap(e){const n=Object.create(R.prototype);return n.ptr=e,n}__destroy_into_raw(){const e=this.ptr;return this.ptr=0,e}free(){const e=this.__destroy_into_raw();s.__wbg_universe_free(e)}width(){var e=s.universe_width(this.ptr);return e>>>0}set_width(e){s.universe_set_width(this.ptr,e)}height(){var e=s.universe_height(this.ptr);return e>>>0}set_height(e){s.universe_set_height(this.ptr,e)}cells(){var e=s.universe_cells(this.ptr);return e}toggle_cell(e,n){s.universe_toggle_cell(this.ptr,e,n)}static new(){var e=s.universe_new();return R.__wrap(e)}render(){try{const i=s.__wbindgen_add_to_stack_pointer(-16);s.universe_render(i,this.ptr);var e=x()[i/4+0],n=x()[i/4+1];return m(e,n)}finally{s.__wbindgen_add_to_stack_pointer(16),s.__wbindgen_free(e,n)}}tick(){s.universe_tick(this.ptr)}}async function ne(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(i){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}async function B(t){typeof t=="undefined"&&(t=new URL("https://sonystone.github.io/app-game/assets/wasm_game_of_life_bg.c71222b5.wasm",self.location));const e={};e.wbg={},e.wbg.__wbindgen_string_new=function(o,r){var a=m(o,r);return D(a)},e.wbg.__wbg_alert_6cacd95f74a2a594=function(o,r){alert(m(o,r))},e.wbg.__wbindgen_object_drop_ref=function(o){J(o)},e.wbg.__wbg_new_693216e109162396=function(){var o=new Error;return D(o)},e.wbg.__wbg_stack_0ddaca5d1abfb52f=function(o,r){var a=O(r).stack,l=Q(a,s.__wbindgen_malloc,s.__wbindgen_realloc),u=L;x()[o/4+1]=u,x()[o/4+0]=l},e.wbg.__wbg_error_09919627ac0992f5=function(o,r){try{console.error(m(o,r))}finally{s.__wbindgen_free(o,r)}},e.wbg.__wbg_log_fbd13631356d44e4=function(o){console.log(O(o))},e.wbg.__wbg_random_7b8246250fd79f60=typeof Math.random=="function"?Math.random:ee("Math.random"),e.wbg.__wbindgen_throw=function(o,r){throw new Error(m(o,r))},(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:n,module:i}=await ne(await t,e);return s=n.exports,B.__wbindgen_wasm_module=i,s}const oe={position:{x:10,y:10}},re={shape:{}},se=M(M({},oe),re);console.log("Renderable",se);class ie{constructor(e){}run(){}}const ae=P("<button>\u25B6</button>"),ce=P("<canvas></canvas>");function _e(){const t=ae.cloneNode(!0),e=ce.cloneNode(!0),n=Y();let i=null;return B().then(o=>{console.log("init wasm-pack",o.memory);const r=5,a="#CCCCCC",l="#FFFFFF",u="#000000",p=R.new(),w=p.width(),h=p.height();e.height=(r+1)*h+1,e.width=(r+1)*w+1;const f=e.getContext("2d");console.log("init wasm-pack",o.memory),e.addEventListener("click",c=>{const d=e.getBoundingClientRect();e.width/d.width,e.height/d.height;const b=(c.clientX-d.left)*1,g=(c.clientY-d.top)*1,E=Math.min(Math.floor(g/(r+1)),h-1),G=Math.min(Math.floor(b/(r+1)),w-1);p.toggle_cell(E,G),S(),T()});const S=()=>{f.beginPath(),f.strokeStyle=a;for(let c=0;c<=w;c++)f.moveTo(c*(r+1)+1,0),f.lineTo(c*(r+1)+1,(r+1)*h+1);for(let c=0;c<=h;c++)f.moveTo(0,c*(r+1)+1),f.lineTo((r+1)*w+1,c*(r+1)+1);f.stroke()},q=(c,d)=>c*w+d,T=()=>{const c=p.cells(),d=new Uint8Array(o.memory.buffer,c,w*h);f.beginPath(),f.fillStyle=u;for(let b=0;b<h;b++)for(let g=0;g<w;g++){const E=q(b,g);f.fillStyle=d[E]===te.Dead?l:u,f.fillRect(g*(r+1)+1,b*(r+1)+1,r,r)}f.stroke()},N=()=>i===null,F=()=>{n.begin(),S(),T(),p.tick(),n.end(),i=requestAnimationFrame(F)},I=()=>{t.textContent="\u23F8",F()},$=()=>{t.textContent="\u25B6",cancelAnimationFrame(i),i=null};t.addEventListener("click",c=>{N()?I():$()}),I()}),new ie({systems:[],entities:[{name:"Human",props:{position:{x:10,y:10}}},{name:"Sheep",props:{position:{x:1,y:20}}},{name:"Plant",props:{position:{x:3,y:14}}},{name:"tree",props:{position:{x:30,y:10}}}]}),X(()=>{cancelAnimationFrame(i)}),[e,t]}export{_e as default};
