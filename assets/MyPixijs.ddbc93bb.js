import{o as bt,w as St,i as B,t as D,x as Et}from"./vendor.110b933d.js";import{P as ot,V as J,X as k,Y,Z as st,_ as gt,y as yt,r as vt,$ as ft,D as rt}from"./pixi.4c9cfd7e.js";function it(t,n,r,e,f,s,i,u){const p=t-r*f,A=n-e*f,o=t+r*s,I=n+e*s;let b,N;i?(b=e,N=-r):(b=-e,N=r);const g=p+b,L=A+N,T=o+b,c=I+N;return u.push(g,L),u.push(T,c),2}function V(t,n,r,e,f,s,i,u){const p=r-t,A=e-n;let o=Math.atan2(p,A),I=Math.atan2(f-t,s-n);u&&o<I?o+=Math.PI*2:!u&&o>I&&(I+=Math.PI*2);let b=o;const N=I-o,g=Math.abs(N),L=Math.sqrt(p*p+A*A),T=(15*g*Math.sqrt(L)/Math.PI>>0)+1,c=N/T;if(b+=c,u){i.push(t,n),i.push(r,e);for(let S=1,a=b;S<T;S++,a+=c)i.push(t,n),i.push(t+Math.sin(a)*L,n+Math.cos(a)*L);i.push(t,n),i.push(f,s)}else{i.push(r,e),i.push(t,n);for(let S=1,a=b;S<T;S++,a+=c)i.push(t+Math.sin(a)*L,n+Math.cos(a)*L),i.push(t,n);i.push(f,s),i.push(t,n)}return T*2}function It(t,n){const r=t.shape;let e=t.points||r.points.slice();const f=n.closePointEps;if(e.length===0)return;const s=t.lineStyle,i=new ot(e[0],e[1]),u=new ot(e[e.length-2],e[e.length-1]),p=r.type!==J.POLY||r.closeStroke,A=Math.abs(i.x-u.x)<f&&Math.abs(i.y-u.y)<f;if(p){e=e.slice(),A&&(e.pop(),e.pop(),u.set(e[e.length-2],e[e.length-1]));const E=(i.x+u.x)*.5,M=(u.y+i.y)*.5;e.unshift(E,M),e.push(E,M)}const o=n.points,I=e.length/2;let b=e.length;const N=o.length/2,g=s.width/2,L=g*g,T=s.miterLimit*s.miterLimit;let c=e[0],S=e[1],a=e[2],l=e[3],$=0,R=0,h=-(S-l),d=c-a,y=0,v=0,P=Math.sqrt(h*h+d*d);h/=P,d/=P,h*=g,d*=g;const K=s.alignment,m=(1-K)*2,_=K*2;p||(s.cap===k.ROUND?b+=V(c-h*(m-_)*.5,S-d*(m-_)*.5,c-h*m,S-d*m,c+h*_,S+d*_,o,!0)+2:s.cap===k.SQUARE&&(b+=it(c,S,h,d,m,_,!0,o))),o.push(c-h*m,S-d*m),o.push(c+h*_,S+d*_);for(let E=1;E<I-1;++E){c=e[(E-1)*2],S=e[(E-1)*2+1],a=e[E*2],l=e[E*2+1],$=e[(E+1)*2],R=e[(E+1)*2+1],h=-(S-l),d=c-a,P=Math.sqrt(h*h+d*d),h/=P,d/=P,h*=g,d*=g,y=-(l-R),v=a-$,P=Math.sqrt(y*y+v*v),y/=P,v/=P,y*=g,v*=g;const M=a-c,q=S-l,j=a-$,W=R-l,G=q*j-W*M,F=G<0;if(Math.abs(G)<.1){o.push(a-h*m,l-d*m),o.push(a+h*_,l+d*_);continue}const tt=(-h+c)*(-d+l)-(-h+a)*(-d+S),et=(-y+$)*(-v+l)-(-y+a)*(-v+R),z=(M*et-j*tt)/G,H=(W*tt-q*et)/G,Q=(z-a)*(z-a)+(H-l)*(H-l),O=a+(z-a)*m,w=l+(H-l)*m,C=a-(z-a)*_,x=l-(H-l)*_,_t=Math.min(M*M+q*q,j*j+W*W),nt=F?m:_,At=_t+nt*nt*L;Q<=At?s.join===Y.BEVEL||Q/L>T?(F?(o.push(O,w),o.push(a+h*_,l+d*_),o.push(O,w),o.push(a+y*_,l+v*_)):(o.push(a-h*m,l-d*m),o.push(C,x),o.push(a-y*m,l-v*m),o.push(C,x)),b+=2):s.join===Y.ROUND?F?(o.push(O,w),o.push(a+h*_,l+d*_),b+=V(a,l,a+h*_,l+d*_,a+y*_,l+v*_,o,!0)+4,o.push(O,w),o.push(a+y*_,l+v*_)):(o.push(a-h*m,l-d*m),o.push(C,x),b+=V(a,l,a-h*m,l-d*m,a-y*m,l-v*m,o,!1)+4,o.push(a-y*m,l-v*m),o.push(C,x)):(o.push(O,w),o.push(C,x)):(o.push(a-h*m,l-d*m),o.push(a+h*_,l+d*_),s.join===Y.BEVEL||Q/L>T||(s.join===Y.ROUND?F?b+=V(a,l,a+h*_,l+d*_,a+y*_,l+v*_,o,!0)+2:b+=V(a,l,a-h*m,l-d*m,a-y*m,l-v*m,o,!1)+2:(F?(o.push(C,x),o.push(C,x)):(o.push(O,w),o.push(O,w)),b+=2)),o.push(a-y*m,l-v*m),o.push(a+y*_,l+v*_),b+=2)}c=e[(I-2)*2],S=e[(I-2)*2+1],a=e[(I-1)*2],l=e[(I-1)*2+1],h=-(S-l),d=c-a,P=Math.sqrt(h*h+d*d),h/=P,d/=P,h*=g,d*=g,o.push(a-h*m,l-d*m),o.push(a+h*_,l+d*_),p||(s.cap===k.ROUND?b+=V(a-h*(m-_)*.5,l-d*(m-_)*.5,a-h*m,l-d*m,a+h*_,l+d*_,o,!1)+2:s.cap===k.SQUARE&&(b+=it(a,l,h,d,m,_,!1,o)));const dt=n.indices,mt=st.epsilon*st.epsilon;for(let E=N;E<b+N-2;++E)c=o[E*2],S=o[E*2+1],a=o[(E+1)*2],l=o[(E+1)*2+1],$=o[(E+2)*2],R=o[(E+2)*2+1],!(Math.abs(c*(l-R)+a*(R-S)+$*(S-l))<mt)&&dt.push(E,E+1,E+2)}function Nt(t,n){let r=0;const e=t.shape,f=t.points||e.points,s=e.type!==J.POLY||e.closeStroke;if(f.length===0)return;const i=n.points,u=n.indices,p=f.length/2,A=i.length/2;let o=A;for(i.push(f[0],f[1]),r=1;r<p;r++)i.push(f[r*2],f[r*2+1]),u.push(o,o+1),o++;s&&u.push(o,A)}function Lt(t,n){t.lineStyle.native?Nt(t,n):It(t,n)}const at={build(t){t.points=t.shape.points.slice()},triangulate(t,n){let r=t.points;const e=t.holes,f=n.points,s=n.indices;if(r.length>=6){const i=[];for(let A=0;A<e.length;A++){const o=e[A];i.push(r.length/2),r=r.concat(o.points)}const u=gt(r,i,2);if(!u)return;const p=f.length/2;for(let A=0;A<u.length;A+=3)s.push(u[A]+p),s.push(u[A+1]+p),s.push(u[A+2]+p);for(let A=0;A<r.length;A++)f.push(r[A])}}},U={geometry:{graphicsData:[{holes:[],points:[],shape:{type:J.POLY,points:[0,0,.5,0,.5,.5,0,.5],closeStroke:!0},fillStyle:{color:16777215,alpha:1},lineStyle:{color:16777215,alpha:1,width:.2,alignment:.5,native:!1,cap:k.ROUND,join:Y.ROUND,miterLimit:10}}],indices:[],points:[],drawCalls:[],tint:16777215,blendMode:yt.NORMAL,closePointEps:1e-4}};function Tt(){const t=U.geometry.graphicsData[0];t.fillStyle,t.lineStyle,at.build(t);for(let n=0;n<2;n++){U.geometry.indices.length;const r=U.geometry.points.length/2;n===0?at.triangulate(t,U.geometry):Lt(t,U.geometry),U.geometry.points.length/2-r}return U.geometry}function ct(t,n,r,e=0,f=1){if(r.indexBuffer){const{length:s,type:i,byteSize:u}=r.indexBuffer;r.instanced?t.drawElementsInstanced(n,s,i,e*u,f):t.drawElements(n,s,i,e*u)}else r.instanced?t.drawArraysInstanced(n,e,r.getSize(),f||1):t.drawArrays(n,e,r.getSize())}var pt=(t=>(t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t))(pt||{});function Pt(){const t=[],n={};let r=!1,e;function f(i){let u=t.indexOf(i);return u===-1&&(t.push(i),u=t.length-1),u}const s={addAttribute(i,u,p=0,A=!1,o=vt.FLOAT,I=0,b=0,N=!1){const g=f(u);return n[i]={buffer:g,size:p,normalized:A,type:o,stride:I,start:b,instance:N},r=N,s},addIndex(i){const u={data:i,type:ft.ELEMENT_ARRAY_BUFFER,usage:35044},p=i.BYTES_PER_ELEMENT,A=p===2?5123:5125,o=i.length;return e={type:A,length:o,byteSize:p},f(u),s},build(){return{buffers:t,attributes:n,instanced:r,indexBuffer:e,getSize(){for(const i in n){const u=n[i];return t[u.buffer].data.length/(u.stride/4||u.size)}return 0}}}};return s}function ut(t,n,r){const e=t.createShader(n);if(t.shaderSource(e,r),t.compileShader(e),t.getShaderParameter(e,t.COMPILE_STATUS))return e;throw new Error(t.getShaderInfoLog(e)||"Unknown error creating shader")}const Dt={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Rt(t){return Dt[t]}let X;const lt={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function ht(t,n){if(!X){const r=Object.keys(lt);X={};for(let e=0;e<r.length;++e){const f=r[e];X[t[f]]=lt[f]}}return X[n]}function Mt(t,n){const r={},e=n.getProgramParameter(t,n.ACTIVE_ATTRIBUTES);for(let f=0;f<e;f++){const s=n.getActiveAttrib(t,f);if(s.name.indexOf("gl_")===0)continue;const i=ht(n,s.type),u={type:i,name:s.name,size:Rt(i),location:n.getAttribLocation(t,s.name)};r[s.name]=u}return r}function Z(t){const n=new Array(t);for(let r=0;r<n.length;r++)n[r]=!1;return n}function Ot(t,n){switch(t){case"float":return 0;case"vec2":return new Float32Array(2*n);case"vec3":return new Float32Array(3*n);case"vec4":return new Float32Array(4*n);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*n);case"ivec3":return new Int32Array(3*n);case"ivec4":return new Int32Array(4*n);case"uvec2":return new Uint32Array(2*n);case"uvec3":return new Uint32Array(3*n);case"uvec4":return new Uint32Array(4*n);case"bool":return!1;case"bvec2":return Z(2*n);case"bvec3":return Z(3*n);case"bvec4":return Z(4*n);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}throw new Error(`Wrong type "${t}"`)}function wt(t,n){const r={},e=n.getProgramParameter(t,n.ACTIVE_UNIFORMS);for(let f=0;f<e;f++){const s=n.getActiveUniform(t,f),i=s.name.replace(/\[.*?\]$/,""),u=!!s.name.match(/\[.*?\]$/),p=ht(n,s.type);r[i]={name:i,index:f,type:p,size:s.size,isArray:u,value:Ot(p,s.size),location:n.getUniformLocation(t,i)}}return r}function Ct(t,n,r){const e=t.createProgram();if(t.attachShader(e,n),t.attachShader(e,r),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS))return e;throw new Error(t.getProgramInfoLog(e)||"Unknown error creating program object")}let xt=0;function Ut(t,n,r){const e=ut(t,t.VERTEX_SHADER,n),f=ut(t,t.FRAGMENT_SHADER,r),s=Ct(t,e,f),i=Mt(s,t),u=wt(s,t);return t.deleteShader(e),t.deleteShader(f),{id:xt++,program:s,vertexSrc:n,fragmentSrc:r,attributeData:i,uniformData:u,useProgram(){t.useProgram(s)}}}var $t=`#version 300 es\r
\r
precision highp float;\r
out vec4 outColor;\r
\r
void main() {\r
    outColor = vec4(1, 1, 1, 1);\r
}`,Bt=`#version 300 es\r
\r
in vec4 position;\r
\r
uniform vec4 u_offset;\r
\r
void main(){\r
    \r
    gl_Position = position + u_offset;\r
}`;function Vt(t,n,r){const e=t.createVertexArray();t.bindVertexArray(e);const{buffers:f,attributes:s}=r,i=[];for(const u of f){const p=t.createBuffer();t.bindBuffer(u.type,p),t.bufferData(u.type,u.data,u.usage),i.push(p)}for(const u in s){const p=s[u];if(n[u]){const A=n[u].location;t.enableVertexAttribArray(A),t.vertexAttribPointer(A,p.size,p.type,p.normalized,p.stride,p.start)}}return{destroy(){for(const u of i)t.deleteBuffer(u)}}}const Ft=D("<canvas></canvas>"),kt=D("<button>\u2192</button>"),Yt=D("<button>\u2190</button>"),qt=D("<button>\u2191</button>"),jt=D("<button>\u2193</button>"),Wt=D("<button>\u21F1</button>"),Gt=D("<button>\u21F2</button>"),zt=D("<div></div>");function Zt(){const t=Ft.cloneNode(!0),{indices:n,points:r}=Tt(),e=[];for(let c=0;c<r.length;)e.push(r[c]),e.push(r[c+1]),e.push(0),c=c+2;console.log("graphic.geometry",e);const f=Pt().addAttribute("position",{data:new Float32Array(e),type:ft.ARRAY_BUFFER,usage:pt.STATIC_DRAW},3).addIndex(new Uint16Array(n)).build();t.width=800,t.height=800;const s=t.getContext("webgl2"),i=Ut(s,Bt,$t);console.log("u_offset",i.uniformData.u_offset);const{destroy:u}=Vt(s,i.attributeData,f);s.useProgram(i.program),s.uniform4fv(i.uniformData.u_offset.location,[0,0,0,0]),i.useProgram(),s.viewport(0,0,s.canvas.width,s.canvas.height),s.clearColor(0,0,0,1),s.clear(s.COLOR_BUFFER_BIT),ct(s,rt.LINES,f),bt(()=>{var c;u(),(c=s.getExtension("WEBGL_lose_context"))==null||c.loseContext()});let p=new St(0,0,0,0);function A(c=0,S=0,a=0){p.set(p.x+c,p.y+S,0,p.w+a),s.useProgram(i.program),s.uniform4fv(i.uniformData.u_offset.location,p.toArray()),s.clear(s.COLOR_BUFFER_BIT),ct(s,rt.TRIANGLES,f)}const o=.1,I=(()=>{const c=kt.cloneNode(!0);return c.$$click=()=>A(o),c})(),b=(()=>{const c=Yt.cloneNode(!0);return c.$$click=()=>A(-o),c})(),N=(()=>{const c=qt.cloneNode(!0);return c.$$click=()=>A(0,o),c})(),g=(()=>{const c=jt.cloneNode(!0);return c.$$click=()=>A(0,-o),c})(),L=(()=>{const c=Wt.cloneNode(!0);return c.$$click=()=>A(0,0,o),c})(),T=(()=>{const c=Gt.cloneNode(!0);return c.$$click=()=>A(0,0,-o),c})();return[t,(()=>{const c=zt.cloneNode(!0);return B(c,I,null),B(c,b,null),B(c,N,null),B(c,g,null),B(c,L,null),B(c,T,null),c})()]}Et(["click"]);export{Zt as default};
